<main class="container py-4" data-controller="welcome">
  <h1 class="pb-4 text-center">UNISCAN.pro</h1>

  <%= search_form_for @q, { class: "row g-3 pb-4" } do |f| %>

    <div class="col-md-3">
      <%= 
        f.select(
          :collection_blockchain_id_eq, 
          options_for_select(
            Blockchain.all.map {|b| [b.name, b.id]}, 
            f.object.collection_blockchain_id_eq
          ),
          { include_blank: "Select Chain" }, 
          { class: "form-control rounded-pill" }
        )
      %>
    </div>

    <div class="col-md-3">
      <%= 
        f.select(
          :collection_nft_type_eq, 
          options_for_select(
            Collection.nft_types.map {|name, num| [name, num]}, 
            f.object.collection_nft_type_eq
          ),
          { include_blank: "Select NFT Type" }, 
          { class: "form-control rounded-pill" }
        )
      %>
    </div>

    <div class="col-md-1">
      <%= f.submit "Submit", { class: "btn btn-primary rounded-pill" } %>
    </div>

    <div class="col-md-4 offset-md-1 text-end">
        <%= sort_link @q, :created_at, "Sort by Time", { default_order: :desc }, { class: "btn btn-link link-secondary px-1" } %>
        <%# <%= sort_link @q, :transfers_24h, "TR24H", {}, { class: "btn btn-link link-secondary px-1" } %1> %>
        <%# <%= sort_link @q, :transfers_7d, "TR7D", {}, { class: "btn btn-link link-secondary px-1" } %1> %>
        <%# <%= sort_link @q, :latest_transfer_time, "LTR", {}, { class: "btn btn-link link-secondary px-1" } %1> %>
    </div>
  <% end %>

  <% if @q_string.include?("created_at desc") %>
    <% if @stream_name.blank? %>
      <%= turbo_stream_from "tokens" %>
    <% else %>
      <%= turbo_stream_from "tokens", @stream_name %>
    <% end %>
  <% end %>
  <div id="tokens" class="row gx-0" data-welcome-target="tokens">
    <%= render @tokens %>
  </div>

  <% unless @pagy.page == @pagy.last %>
    <div class="row gx-0">
      <button type="button" class="btn btn-outline-primary rounded-pill mt-4" data-action="welcome#loadMore" data-welcome-target="loadMoreBtn">
        Load More
      </button>
      <div data-welcome-target="url"><%= @next_page_url %></div>
    </div>
  <% end %>

</main>
